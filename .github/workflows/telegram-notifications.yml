name: ðŸŽ‚ Daily Birthday Countdown Notifications

on:
  schedule:
    # Runs at 10:00 AM UTC every day
    # Format: minute hour day month day-of-week
    - cron: '0 10 * * *'
  
  # Allow manual triggering from GitHub UI
  workflow_dispatch:
    inputs:
      day_override:
        description: 'Override day number (1-20)'
        required: false
        type: number

# Add permissions for workflow
permissions:
  contents: write  # Allows writing to subscribers.json

jobs:
  send-daily-notification:
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: ðŸŸ¢ Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
          
      - name: ðŸ“¦ Install dependencies
        run: npm init -y && npm install dotenv
        
      - name: ðŸ¤– Send Telegram notifications
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          GITHUB_PAGES_URL: ${{ secrets.GITHUB_PAGES_URL }}
          DAY_OVERRIDE: ${{ inputs.day_override }}
        run: node telegram-bot.js
        
      - name: ðŸ’¾ Commit any changes
        run: |
          git config --global user.name 'GitHub Actions Bot'
          git config --global user.email 'actions@github.com'
          git add -A
          git commit -m "ðŸ“… Update subscriber data" || echo "No changes to commit"
          git push
          
      - name: âœ… Completion message
        run: echo "ðŸŽ‰ Daily notifications sent successfully!"
